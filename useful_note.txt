Вот полная шпаргалка по Docker-командам для работы с Airflow на Windows:

1. Основные команды управления контейнерами
powershell
# Запуск всех сервисов в фоновом режиме
docker compose up -d

# Остановка всех сервисов (без удаления данных)
docker compose down

# Полная остановка с удалением ВСЕХ данных
docker compose down -v

# Перезапуск конкретного сервиса (например, postgres)
docker compose restart postgres

# Просмотр запущенных контейнеров
docker ps
2. Работа с MinIO (S3)
powershell
# Создать бакет в MinIO
docker compose exec minio-init /bin/sh -c "
  /usr/bin/mc config host add minio http://minio:9000 airflow airflow123;
  /usr/bin/mc mb minio/car-prices-bucket;
  /usr/bin/mc policy set public minio/car-prices-bucket
"

# Загрузить файл в MinIO (2 способа)
# Способ 1: Через временный контейнер
docker cp cars_20250515.csv airflow-minio-1:/tmp/
docker compose run --rm minio-init /bin/sh -c "
  /usr/bin/mc cp /tmp/cars_20250515.csv minio/car-prices-bucket/
"

# Способ 2: Через веб-интерфейс (http://localhost:9001)
3. Работа с PostgreSQL
powershell
# Подключиться к PostgreSQL интерактивно
docker exec -it airflow-postgres-1 psql -U airflow

# Просмотр всех баз данных
docker exec -it airflow-postgres-1 psql -U airflow -c "\l"

# Просмотр таблиц в конкретной БД
docker exec -it airflow-postgres-1 psql -U airflow -d news_db -c "\dt"

# Выполнить SQL-скрипт из файла
docker exec -i airflow-postgres-1 psql -U airflow -d news_db < init-db.sql
4. Просмотр логов
powershell
# Логи Airflow Webserver
docker logs airflow-airflow-webserver-1

# Логи PostgreSQL
docker logs airflow-postgres-1 | findstr "ERROR"

# Логи конкретной задачи DAG
docker logs airflow-airflow-webserver-1 | findstr "process_file"
5. Управление DAG
powershell
# Просмотр файлов DAG в контейнере
docker exec airflow-airflow-webserver-1 ls /opt/airflow/dags

# Принудительный запуск DAG (если не срабатывает по расписанию)
# Делается через веб-интерфейс: http://localhost:8080
6. Полезные команды для диагностики
powershell
# Проверить здоровье сервисов
docker compose ps

# Просмотреть переменные окружения контейнера
docker inspect airflow-airflow-webserver-1 | findstr "Env"

# Удалить все неиспользуемые данные
docker system prune -a
Важные нюансы для Windows:
Все пути к файлам указывайте с двойными слешами (C:\\airflow\\dags)

Для поиска в логах используйте findstr вместо grep

Файлы должны быть в формате Unix (LF), а не Windows (CRLF)

Для файлов инициализации используйте .sql вместо .sh

Пример рабочего процесса:
docker compose down -v

Внести изменения в docker-compose.yaml

docker compose up -d

docker compose exec minio-init ... (настройка MinIO)

Проверить логи при возникновении ошибок

Эта шпаргалка покрывает все основные сценарии работы с Airflow в Docker на Windows.
